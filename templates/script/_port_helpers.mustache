# Generate random integer in range [$1..$2)
function random () {
    local MIN=$1
    local MAX=$2
    local RANGE=$((MAX - MIN))
    local RAND=$(od -An -N4 -t uL /dev/urandom | tr -d " ")
    local RAND_MAX=$((2**(4*8)))

    local FLOAT=$(echo "$RANGE * ($RAND / $RAND_MAX) + $MIN" | bc -l)

    echo $(echo "$FLOAT / 1" | bc)
}

# Check if port is used
function used_ports () {
    local PORT=$1

    echo $(netstat -lnt | awk -v port=$PORT '$6 == "LISTEN" && $4 ~ ":"port"$"' | wc -l)
}

# Get available port
function get_port () {
  local PORT=$(random 2000 65535)
  while [[ $(used_ports ${PORT}) -ne 0 ]]; do
      PORT=$(random 2000 65535)
  done
  echo ${PORT}
}
